# Phase 2 Performance Optimization - Implementation Plan

## Analysis Summary

After reviewing the code, I've confirmed the following issues:

### Task 2.1: MiniPlayer rebuild issue ✅ CONFIRMED
- Line 40: `ref.watch(audioControllerProvider)` watches entire state
- Causes rebuild on every position update (~1 per second)
- **Fix**: Split into 4 sub-widgets with granular watching

### Task 2.2: ListTile layout jitter ✅ CONFIRMED
- `_ExploreTrackTile` (explore_page.dart:262): Uses `ListTile` with `leading: Row(...)`
- `_RankingTrackTile` (home_page.dart:995): Uses `ListTile` with `leading: Row(...)`
- **Fix**: Convert to flat `InkWell + Padding + Row` layout

### Task 2.3: HomePage section rebuilds ✅ CONFIRMED
- Line 40: Parent watches full `audioControllerProvider`
- `_buildNowPlaying` and `_buildQueuePreview` receive `playerState` parameter
- **Fix**: Extract as separate ConsumerWidgets with granular watching

### Task 2.4: FileExistsCache cascade rebuilds ✅ CONFIRMED
- TrackThumbnail line 50: `ref.watch(fileExistsCacheProvider)` watches entire Set
- Any path addition triggers all thumbnails to rebuild
- **Fix**: Use `.select()` to watch only specific paths (but this is complex - may skip)

## Implementation Order

1. **Task 2.2** - Easiest, no dependencies
2. **Task 2.1** - Medium complexity, high impact
3. **Task 2.3** - Medium complexity, depends on understanding provider structure
4. **Task 2.4** - Complex, may skip if too difficult

## Notes

- Task 2.5 (other optimizations) marked as P2/optional - will skip
- All changes should maintain existing functionality
- Need to test scrolling performance after each change
