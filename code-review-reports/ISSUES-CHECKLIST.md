# FMP ä»£ç å®¡æŸ¥ - é—®é¢˜æ¸…å•ä¸ä¿®å¤è®¡åˆ’

**ç”Ÿæˆæ—¥æœŸ**: 2026-02-17
**æ€»é—®é¢˜æ•°**: 38 ä¸ª
**é¢„è®¡æ€»å·¥ä½œé‡**: çº¦ 30 å°æ—¶

---

## ğŸ”´ é«˜ä¼˜å…ˆçº§é—®é¢˜ï¼ˆ13 ä¸ªï¼‰- å¿…é¡»ç«‹å³ä¿®å¤

### å¿«é€Ÿä¿®å¤ï¼ˆ~1.5 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 1 | SearchPage AppBar ç¼ºå°‘å°¾éƒ¨é—´è· | `lib/ui/pages/search/search_page.dart:113` | 5 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 2 | ç¡¬ç¼–ç åœ†è§’å€¼ | `lib/ui/pages/library/widgets/cover_picker_dialog.dart:320` | 5 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 3 | æ’è¡Œæ¦œåˆ—è¡¨ç¼ºå°‘ ValueKey | `explore_page.dart:206`, `home_page.dart:254` | 15 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 4 | QueueManager.dispose() ä¸å®Œæ•´ | `lib/services/audio/queue_manager.dart:231` | 5 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 5 | AudioController.dispose() éœ€å¢å¼º | `lib/services/audio/audio_provider.dart:577-590` | 15 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 6 | Future.microtask ç¼ºå°‘é”™è¯¯å¤„ç† | `audio_provider.dart:2340` | 15 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 7 | Isolate é”™è¯¯ä¼ é€’ç»“æ„åŒ– | `download_service.dart` `_isolateDownload` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |

### éœ€è¦å‡ å°æ—¶ä¿®å¤ï¼ˆ~8 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 8 | PlaylistDetailPage åˆ†ç»„é‡å¤è®¡ç®— | `lib/ui/pages/library/playlist_detail_page.dart:172` | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 9 | HomePage è¿‡åº¦ rebuild | `lib/ui/pages/home/home_page.dart:86-88` | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 10 | æ–‡ä»¶æ“ä½œé”™è¯¯å¤„ç†ä¸å¥å£® | `lib/services/download/download_service.dart` | 2-3 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 11 | Timer æœªå–æ¶ˆï¼ˆ5 ä¸ªæœåŠ¡ç±»ï¼‰ | RankingCacheService, RadioController ç­‰ | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 12 | DownloadService Isolate å–æ¶ˆç«æ€ | `download_service.dart:407-420` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 13 | AudioController å¿«é€Ÿåˆ‡æ­Œç«æ€ | `audio_provider.dart` `_restoreSavedState()` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |

**é«˜ä¼˜å…ˆçº§å°è®¡**: ~9.5 å°æ—¶

---

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§é—®é¢˜ï¼ˆ15 ä¸ªï¼‰- è¿‘æœŸä¿®å¤

### æ€§èƒ½ä¼˜åŒ–ï¼ˆ~4 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 14 | FileExistsCache åœ¨ build ä¸­è§¦å‘å¼‚æ­¥ | å¤šä¸ªé¡µé¢ | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 15 | PlayerPage æœªä½¿ç”¨ const | `lib/ui/pages/player/player_page.dart` | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 16 | æ–‡ä»¶åˆ é™¤é˜»å¡ä¸»çº¿ç¨‹ | åˆ é™¤æ“ä½œ | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

### é”™è¯¯å¤„ç†ï¼ˆ~2 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 17 | ä¸‹è½½å¤±è´¥ç¼ºå°‘ä¸»åŠ¨æç¤º | `download_service.dart` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 18 | YouTube é™æµæ£€æµ‹ä¸å¯é  | `youtube_source.dart` `_isRateLimitError` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 19 | ä¸‹è½½é”™è¯¯å¤„ç†ä»£ç é‡å¤ | `download_service.dart` `_startDownload` | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

### UI ä¸€è‡´æ€§ï¼ˆ~5 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 20 | æ­Œæ›²åˆ—è¡¨é¡¹æ ·å¼åˆ†æ•£ | HomePage, ExplorePage, PlaylistDetailPage | 4-6 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 21 | DownloadManagerPage éœ€ç¡®è®¤é—´è· | `lib/ui/pages/settings/download_manager_page.dart:23-28` | 5 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |

### ä¸šåŠ¡é€»è¾‘ï¼ˆ~2 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 22 | Mix æ¨¡å¼é˜Ÿåˆ—æ“ä½œé™åˆ¶æœªå®ç° | `audio_provider.dart` `addToQueue/addNext` | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 23 | é˜Ÿåˆ—æ“ä½œè¿”å›å€¼è¯­ä¹‰ä¸æ˜ç¡® | `audio_provider.dart` | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

### å†…å­˜ç®¡ç†ï¼ˆ~3 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 24 | æ·»åŠ å†…å­˜å‹åŠ›å“åº”æœºåˆ¶ | æ–°å»º `memory_manager.dart` | 3 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

### é£é™©é—®é¢˜ï¼ˆ~2 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 25 | StreamController æœªå…³é—­ | éƒ¨åˆ†æœåŠ¡ç±» | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 26 | PlayQueue æŒä¹…åŒ–å¤±è´¥åœºæ™¯ | `queue_manager.dart` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 27 | FileExistsCache ä¸æ–‡ä»¶çŠ¶æ€ä¸åŒæ­¥ | `file_exists_cache.dart` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 28 | å­˜å‚¨æƒé™å¤„ç†éœ€åŠ å¼º | Android å¹³å° | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

**ä¸­ä¼˜å…ˆçº§å°è®¡**: ~18 å°æ—¶

---

## ğŸŸ¢ ä½ä¼˜å…ˆçº§é—®é¢˜ï¼ˆ10 ä¸ªï¼‰- å¯é€‰ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–ï¼ˆ~2 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 29 | Settings é¡µé¢ä½¿ç”¨ ListView | `lib/ui/pages/settings/settings_page.dart` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |
| 30 | åŠ¨æ€è°ƒæ•´å›¾ç‰‡ç¼“å­˜å¤§å° | `network_image_cache_service.dart` | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

### é”™è¯¯å¤„ç†ï¼ˆ~1.5 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 31 | æ§åˆ¶æµå¼‚å¸¸é‡æ„ | `audio_provider.dart` `_RetryScheduledException` | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 32 | JSON è§£æé”™è¯¯ä¿¡æ¯ä¸æ˜ç¡® | `youtube_source.dart:819` | 30 åˆ†é’Ÿ | â¬œ å¾…ä¿®å¤ |

### UI ä¸€è‡´æ€§ï¼ˆ~6 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 33 | åˆ›å»ºå…±äº«èœå•æ“ä½œå¤„ç†å™¨ | æ–°å»º `track_menu_handler.dart` | 3 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 34 | åˆ›å»ºç»Ÿä¸€ç©ºçŠ¶æ€ç»„ä»¶ | æ–°å»º `empty_state.dart` | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

### ä¸šåŠ¡é€»è¾‘ï¼ˆ~4 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 35 | æ·»åŠ æ‰¹é‡é˜Ÿåˆ—æ“ä½œæ–¹æ³• | `audio_provider.dart` | 2 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 36 | æ”¹è¿›æ‰¹é‡æ“ä½œé”™è¯¯æç¤º | å¤šä¸ªé¡µé¢ | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

### é£é™©é—®é¢˜ï¼ˆ~1 å°æ—¶ï¼‰

| # | é—®é¢˜ | ä½ç½® | å·¥ä½œé‡ | çŠ¶æ€ |
|---|------|------|--------|------|
| 37 | Isar äº‹åŠ¡é”™è¯¯æ¢å¤ | æ•°æ®åº“æ“ä½œ | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |
| 38 | å¹³å°ç‰¹å®šä»£ç å¼‚å¸¸å¤„ç† | Platform.isAndroid/isWindows | 1 å°æ—¶ | â¬œ å¾…ä¿®å¤ |

**ä½ä¼˜å…ˆçº§å°è®¡**: ~14.5 å°æ—¶

---

## ğŸ“… å»ºè®®çš„ä¿®å¤è®¡åˆ’

### Week 1: é«˜ä¼˜å…ˆçº§é—®é¢˜

**Day 1-2** (å¿«é€Ÿä¿®å¤):
- [ ] é—®é¢˜ 1-7: å¿«é€Ÿä¿®å¤ï¼ˆ1.5 å°æ—¶ï¼‰
- [ ] é—®é¢˜ 8: PlaylistDetailPage åˆ†ç»„ç¼“å­˜ï¼ˆ1 å°æ—¶ï¼‰
- [ ] é—®é¢˜ 9: HomePage rebuild ä¼˜åŒ–ï¼ˆ2 å°æ—¶ï¼‰

**Day 3-4** (ç¨³å®šæ€§):
- [ ] é—®é¢˜ 10: æ–‡ä»¶æ“ä½œé”™è¯¯å¤„ç†ï¼ˆ2-3 å°æ—¶ï¼‰
- [ ] é—®é¢˜ 11: Timer dispose è¡¥å…¨ï¼ˆ2 å°æ—¶ï¼‰

**Day 5** (ç«æ€æ¡ä»¶):
- [ ] é—®é¢˜ 12: Isolate å–æ¶ˆç«æ€ï¼ˆ30 åˆ†é’Ÿï¼‰
- [ ] é—®é¢˜ 13: å¿«é€Ÿåˆ‡æ­Œç«æ€ï¼ˆ30 åˆ†é’Ÿï¼‰
- [ ] æµ‹è¯•å’ŒéªŒè¯

### Week 2: ä¸­ä¼˜å…ˆçº§é—®é¢˜

**Day 1-2** (æ€§èƒ½ä¼˜åŒ–):
- [ ] é—®é¢˜ 14-16: æ€§èƒ½ä¼˜åŒ–ï¼ˆ6 å°æ—¶ï¼‰

**Day 3** (é”™è¯¯å¤„ç†):
- [ ] é—®é¢˜ 17-19: é”™è¯¯å¤„ç†æ”¹è¿›ï¼ˆ3 å°æ—¶ï¼‰

**Day 4-5** (UI å’Œé€»è¾‘):
- [ ] é—®é¢˜ 20: åˆ—è¡¨é¡¹ç»Ÿä¸€ï¼ˆ4-6 å°æ—¶ï¼‰
- [ ] é—®é¢˜ 22-23: ä¸šåŠ¡é€»è¾‘ï¼ˆ2 å°æ—¶ï¼‰

### Week 3+: ä½ä¼˜å…ˆçº§é—®é¢˜

æ ¹æ®å®é™…æƒ…å†µå’Œä¼˜å…ˆçº§ï¼Œé€æ­¥å¤„ç†ä½ä¼˜å…ˆçº§é—®é¢˜ã€‚

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

**æ€»ä½“è¿›åº¦**: 0/38 (0%)

- ğŸ”´ é«˜ä¼˜å…ˆçº§: 0/13 (0%)
- ğŸŸ¡ ä¸­ä¼˜å…ˆçº§: 0/15 (0%)
- ğŸŸ¢ ä½ä¼˜å…ˆçº§: 0/10 (0%)

**é¢„æœŸå®Œæˆæ—¶é—´**:
- é«˜ä¼˜å…ˆçº§: 1-2 å‘¨
- ä¸­ä¼˜å…ˆçº§: 2-3 å‘¨
- ä½ä¼˜å…ˆçº§: æŒ‰éœ€å®‰æ’

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### ä»Šå¤©å°±å¯ä»¥ä¿®å¤çš„é—®é¢˜ï¼ˆ30 åˆ†é’Ÿï¼‰

1. **SearchPage AppBar é—´è·** (5 åˆ†é’Ÿ)
   ```dart
   // lib/ui/pages/search/search_page.dart:113
   actions: [
     if (_searchController.text.isNotEmpty)
       IconButton(...),
     const SizedBox(width: 8),  // æ·»åŠ è¿™ä¸€è¡Œ
   ],
   ```

2. **ç¡¬ç¼–ç åœ†è§’å€¼** (5 åˆ†é’Ÿ)
   ```dart
   // lib/ui/pages/library/widgets/cover_picker_dialog.dart:320
   borderRadius: isSelected
       ? AppRadius.borderRadiusSm  // æ›¿æ¢ BorderRadius.circular(5)
       : AppRadius.borderRadiusLg, // æ›¿æ¢ BorderRadius.circular(8)
   ```

3. **QueueManager.dispose()** (5 åˆ†é’Ÿ)
   ```dart
   // lib/services/audio/queue_manager.dart:231
   void dispose() {
     _savePositionTimer?.cancel();
     _fetchingUrlTrackIds.clear();  // æ·»åŠ è¿™ä¸€è¡Œ
     _stateController.close();
   }
   ```

4. **æ’è¡Œæ¦œ ValueKey** (15 åˆ†é’Ÿ)
   ```dart
   // explore_page.dart:206 å’Œ home_page.dart:254
   ListView.builder(
     itemBuilder: (context, index) {
       final track = tracks[index];
       return _ExploreTrackTile(
         key: ValueKey('${track.sourceId}_${track.pageNum}'),  // æ·»åŠ è¿™ä¸€è¡Œ
         track: track,
         ...
       );
     },
   )
   ```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **ç»¼åˆæŠ¥å‘Š**: `FINAL-COMPREHENSIVE-REPORT.md` - å®Œæ•´çš„åˆ†æå’Œå»ºè®®
- **é¡¹ç›®æ–‡æ¡£**: `CLAUDE.md` - é¡¹ç›®æ ¸å¿ƒæ–‡æ¡£
- **UI è§„èŒƒ**: Serena è®°å¿† `ui_coding_patterns`
- **æ¶æ„æ–‡æ¡£**: Serena è®°å¿† `architecture`, `audio_system`

---

**æœ€åæ›´æ–°**: 2026-02-17
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
